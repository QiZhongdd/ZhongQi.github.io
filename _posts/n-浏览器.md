**浏览器有哪些进程**

- 浏览器进程：主要负责页面的显示、用户交互、子进程管理，同时提供存储的功能
- 渲染进程：核心任务是将 HTML、CSS 和 JS 转换为用户可交互的网页，排版引擎 Blink 和 V8 引擎都都是运行在这，默认情况 Chrome 是一个 tab 一个渲染进程（假如多个 tab 在同一站点（同源），那么共用一个渲染进程，但在a标签跳转的时候添加 rel='noopener',可以不共用进程），处于安全考虑，渲染进程是运行在沙箱下的
- GPU 进程，GPU 主要是为了绘制 UI（渲染交个渲染进程）
- 网络进程用于网络资源的加载
- 插件进程用于运行插件，插件比较容易崩溃。


**输入一个url会发生什么**

- 首先会判断输入的内容是否符合url规则，如果不符合那么搜索引擎会合成url带上关键字进行搜索。符合的话那么会进行跳转。跳转的时候会触发当前节目界面的beforeunload事件，在这个事件中我们可以做一些数据的清除，还可以询问用户是否离开该界面。
- 浏览器向服务器发送请求，发送请求前首先会查找缓存，比如dns缓存、http缓存。
- 然后准备ip地址和端口号，如果没有dns缓存那么会进行dns解析获取，如果是http请求的话端口号是80，https默认是443。如果是https的话还会进行https的证书验证
- 准备好ip和端口后进入tcp等待队列，浏览器默认支持6个tcp连接，超过了就得进行等待。
- 等待后进入tcp连接，使用三次握手协议
- tcp连接后发送请求信息，请求信息包括请求行、请求头、请求体、
- 服务器收到请求后会进行响应，返回content-type如果是application/octep-stream那么浏览器的下载管理器会进行下载，如果是text/html那么会进行显示html。
- tcp断开链接，采用四次挥手，如果有keep-alive那么会保持链接，可以省去下次tcp连接时间,http1.1后默认开启了持久化链接。
- 如果返回的状态码是301和302那么会进行重定向。
- 收到html后那么就会进行渲染，首先会构建DOM树，dom树可以被js进行修改
- 进行样式计算，样式计算遵循继承和层叠计算原则
- 生成布局树，在这个阶段会遍历dom，将可见的dom添加进布局树中，如果是dispay:none是不会添加进入的
- 进行布局计算，将每个元素的几何位置添加到布局树钟
- 分层，页面中有许多复杂的效果，比如3D转换、页面的滚动、或者使用z-index做z轴的排序，为了实现这些效果，渲染引擎会专门生成对应的图层，并生成一颗图层树。生成图层得满足以下的条件： 拥有层叠上下文属性的元素会被提升为单独的一层。明确定位属性的元素、定义透明属性的元素、使用 CSS 滤镜的元素等，都拥有层叠上下文属性。 需要剪裁（clip）的地方也会被创建为图层，如果出现滚动条，滚动条也会被提升为单独的层。
- 图层的绘制，所谓的绘制是指将图层分绘制拆封成很多小的指令，然后在把这些很小的指令生成待绘制的列表，用于绘制的顺序。绘制列表会传递给合成线程
- 合成线程收到绘制列表时会进行删格化操作，删格化操作前会将图层划分成图块，这是因为如果将整个图层进行删格化对浏览器开销比较大，然后在将视口附近的图快生成位图，生成位图的操作称为删格化。渲染进程维护了一个删格化线程，所有的删格化都是在这个线程池完成。删格化还会进行gpu加速，被称为gpu删格化。而gpu操作是在gpu进程中运行的，生成的位图被保存在 GPU 内存中，代所有图块完成光栅化后，将结果返回给合成线程。所以这就涉及到了跨进程的处理。
- 合成显示，一旦所有的图快都完成了栅格化，合成线程就会生成一个“DrawQuad”绘制图层的指令，然后将该指令提交给浏览器进程的viz组件，然后浏览器进程会根据drawquad指令将页面内容绘制到内存中显示。


**DOM树是如何生成的**

- 渲染引擎接受到html后会交给html解析器解析成字节流，这是一个边接受html变解析的过程。
- 然后字节流会进行分词，转换成Token。Token包括Text Token和Tage Token。Tage Token又分为start tage和end tag
- 然后将分词转换成dom，构建dom树。在这个阶段会维护一个Token栈用来维护父子关系。如果是start Tag那么会入栈，将该节点添加进dom树。他的父节点即上一个栈顶元素。如果是文本Token那么不添加进栈中，直接添加进dom树。如果是endtag，那么会查看栈顶元素是否是对应的start tag。如果是从栈顶中弹出，代表当前节点解析完成。


