---
layout: post
title: 宏观视角下的浏览器（1）
subtitle: 线程与进程以及浏览器的演变
date: 2020-12-09
author: Qi
header-img: img/404-bg.jpg
catalog: true
tags:
  - 浏览器
---

# 浏览器打开页面有多少个进程

浏览器打开一个页面至少需要启动四个进程，分别是网络进程、渲染进程、GPU 进程、浏览器进程，如果页面有插件，那么还需要有插件进程

**什么是并行**

并行是只多个线程在同一时刻处理多个任务，使用并行处理能大大提升性能。并发是只在同一个时刻发送或者接受多个请求

# 进程和线程

**线程和进程**

- 线程是不能单独存在的，必须依赖于进程，由进程启动和管理

- 进程是指一个程序的运行实例，简单的说就是程序启动的时候操作系统会给程序创建一块内存，用来存放代码、数据和执行任务的主线程

**进程与线程的关系**

- 进程中任意一个线程崩溃，都会导致进程崩溃
- 线程共用一套代码、数据、文件，但线程有自己的栈、寄存器
- 当一个进程关闭时，操作系统会回收该进程所占用的内存
- 进程之间的内容时需要相互隔离的，如果需要进行通信那么就需要使用 IPC 机制（进程间的通信，指两个进程之间进行数据交换）

  ![Image text](/img/WechatIMG78.png)

# 单进程时代浏览器的问题

- 不稳定，早期的浏览器需要用插件来运行视频、游戏等，但插件是最容易出问题的模块，还允许在浏览器进程中，所以插件崩溃了就会导致进程崩溃

- 不流畅，渲染、插件、js 执行环境都在一个线程中，意味着同一个时刻只能有一个模块运行，同时可能导致内存泄漏，运行的时间越长内存的占用就会越高。

- 不安全，如果运行一个恶意的插件或者脚本，但只有一个进程，这意味着恶意的插件和脚本就能控制你的电脑。

# 多进程时代

**浏览器有哪些进程**

- 浏览器进程：主要负责页面的显示、用户交互、子进程管理，同时提供存储的功能
- 渲染进程：核心任务是将 HTML、CSS 和 JS 转换为用户可交互的网页，排版引擎 Blink 和 V8 引擎都都是运行在这，默认情况 Chrome 是一个 tab 一个渲染进程（假如多个 tab 在同一站点（同源），那么共用一个渲染进程，但在a标签跳转的时候添加 rel='noopener',可以不共用进程），处于安全考虑，渲染进程是运行在沙箱下的
- GPU 进程，GPU 主要是为了绘制 UI（渲染交个渲染进程）
- 网络进程用于网络资源的加载
- 插件进程用于运行插件，插件比较容易崩溃。

**多进程如何解决单进程的问题**

- 不稳定，多进程有多个插件，每个插件都用沙箱隔离，比如运行插件进程，插件进程崩溃了，并不会影响到其他进程，其他进程会照常运行

- 不流畅，js 的运行时运行在渲染进程中的，如果 js 陷入了死循环，那么 js 会阻塞当前渲染进程，并不会影响到其他页面，同时关掉当前页面，那么当前渲染进程占用的内存都会被回收，这样就解决了内存泄漏的问题

- 不安全，浏览器的进程都用了沙箱隔离，不会相互影响，如果执行了恶意插件，并不会影响到其他进程
