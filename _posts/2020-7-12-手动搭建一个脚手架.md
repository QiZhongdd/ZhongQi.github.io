---
layout: post
title: æ‰‹åŠ¨æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶
subtitle: æ‰‹åŠ¨æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶
date: 2020-07-12
author: Qi
header-img: img/404-bg.jpg
catalog: true
tags:
  - cli
---

# ç®€ä»‹

æ‰‹åŠ¨æ­å»º cli ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘å¹³æ—¶é‡å¤æ­å»ºæ¶æ„ï¼ŒåŒæ—¶åœ¨å¹³æ—¶å¼€å‘ä¸­ä¸æƒ³å¼•ç”¨ vue-cli å’Œ react-cli,å› ä¸ºä¸èƒ½éšæ„æ”¹é€ è¿™ä¸¤ä¸ª cliã€‚

# æ­å»ºæ­¥éª¤

**åˆ›å»ºç›®å½•ï¼Œä½¿ç”¨ npm init åˆå§‹åŒ–**
**npm instal ç›¸å…³çš„åŒ…ï¼Œcommander ï¼Œshelljs å¿…é¡»æŒ‰ç…§**

- commander æ˜¯ç”¨äº node.js å‘½ä»¤è¡Œç•Œé¢çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦æ˜¯ä¸ºäº†å®šä¹‰ç›¸å…³å¯¹çš„å‘½ä»¤ï¼ŒåŒæ—¶è·å–å‘½ä»¤è¡Œæ‰§è¡Œç›¸å…³çš„ handler.
- ShellJS æ˜¯åœ¨ Node.js API ä¹‹ä¸Šçš„ Unix shell å‘½ä»¤çš„å¯ç§»æ¤å®ç°,ä½¿ç”¨ shelljs ä¸»è¦æ˜¯ä¸ºäº†è‡ªåŠ¨æ‰§è¡Œç›¸å…³æ“ä½œå‘½ä»¤ä¸ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚

**å»ºç«‹ bin æ–‡ä»¶å¤¹å’Œ cli æ–‡ä»¶**

```
-bin
- - xx-cli
```


**å°†è„šæ‰‹æ¶æŒ‰ç…§åˆ°å…¨å±€**
- åœ¨ cli æ–‡ä»¶çš„é¦–è¡Œæ·»åŠ #!/usr/bin/env nodeï¼Œä¸»è¦æ˜¯ä¸ºäº†è®©ç³»ç»Ÿçœ‹åˆ°è¿™ä¸€è¡Œçš„æ—¶å€™ï¼Œä¼šæ²¿ç€è¯¥è·¯å¾„å»æŸ¥æ‰¾ node å¹¶æ‰§è¡Œ,èƒ½å¤Ÿé€‚åº”ä¸åŒçš„æ“ä½œç³»ç»Ÿ

```
!/usr/bin/env node

```

 - åœ¨ package.json æ·»åŠ  bin

```
"bin":{
 xxcli:bin/xx-cli
}
```

- ä½¿ç”¨ npm link å°±å¯å°† cli æŒ‚è½½åˆ°å…¨å±€

```
npm link

```

- æŒ‰ç…§å®Œåå°±å¯ä»¥ä½¿ç”¨ xxcli æ‰§è¡Œæ–‡ä»¶ï¼Œä¸éœ€è¦åœ¨ç”¨ node ./bin/xxcli äº†

- å‘å¸ƒ npm åŒ…,ç„¶åå®‰è£… npm install -g xxcliï¼Œå°±å¯ä»¥å°†åŒ…å®‰è£…è‡³å…¨å±€ 





**ç¼–å†™ xx-cli**

- å¼•å…¥ commander å’Œ shelljs

```
const shell = require("shelljs");
);
const { program } = require("commander");

```

- åˆ©ç”¨ commader è®¾ç«‹è„šæ‰‹æ¶ç›¸å…³çš„å‘½ä»¤

```
program
  .option("-c,create", "åˆ›å»ºä¸€ä¸ªç»„ä»¶")
  .option("-j,json2ts", "é›†æˆquicktype");

program.parse(process.argv);//ä¸€å®šè¦åŠ ï¼Œä¸ç„¶æ— æ³•è§£æå‘½ä»¤è¡Œ
```

åˆ©ç”¨ node ./bin/xx-cli --help å¯ä»¥æŸ¥çœ‹ç›¸å…³çš„å‘½ä»¤

```
  -v, --version  output the version number
  -c,create      åˆ›å»ºä¸€ä¸ªç»„ä»¶
  -j,json2ts     é›†æˆquicktype
  -h, --help     display help for command
```

- åˆ©ç”¨ commander è·å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤è¡Œï¼Œæ‰§è¡Œç›¸å…³çš„ handleï¼Œhandler é‡Œé¢ç”¨ shelljs æ‰§è¡Œç›¸å…³çš„ shell å‘½ä»¤

```
const handlers = {
   json2ts:function(){const data = {
      yideng: 'laoyuan',
      data: {
        age: 30 || '',
      },
    };
    const jsonContent = JSON.stringify(data);
    let result = json2ts.convert(jsonContent);
    console.log(result);
   }
};

program
  .usage("[cmd] <options>")
  .arguments("<cmd> [env]")
  .action((cmd, otherParams) => {
    console.log(cmd, otherParams);
    const handler = handlers[cmd];
    if (typeof handler == "undefined") {
      console.log(chalk.blue(`${cmd}`) + chalk.red("æš‚æœªæ”¯æŒ"));
    } else {
      handler(otherParams);
    }
  });
```

- åˆ©ç”¨inquirer ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ï¼Œæ¯”å¦‚ä¾›ç”¨æˆ·é€‰æ‹©ç›¸å…³çš„é€‰é¡¹ã€æˆ–è€…å¡«å…¥é¡¹ç›®åç§°ã€‚ç„¶åå†ç”¨download-git-repoä¸‹è½½å¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶ã€‚æœ€åç”¨shellæ–‡ä»¶ä¸‹è½½æ–‡ä»¶
```
const bindHandler = {
  create(otherParmas) {
    inquirer
      .prompt([
        {
          type: 'text',
          message: 'â‘  ğŸ’Œ è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°',
          name: 'dirname',
        },
        {
          type: 'list',
          name: 'jskind',
          message: 'â‘¡ è¯·é€‰æ‹©å¼€å‘è¯­è¨€',
          choices: ['â˜‰ TypeScript', 'â˜‰ EcmaScript6'],
        },
      ])
      .then((answers) => {
        console.log(answers.dirname);
        const _pwd = shell.pwd().stdout;
        const projectPath = `${_pwd}/${answers.dirname}`;
        console.log('ç”¨æˆ·çš„å…¨è·¯å¾„', projectPath, answers.jskind);
        shell.rm('-rf', projectPath);
        shell.mkdir(projectPath);
        const spinner = ora('â° downloading template.....');
        spinner.start();
        const template =
          'direct:https://github.com/lgwebdream/yd-vue-kernel.git';
        download(template, projectPath, { clone: true }, function (err) {
          spinner.stop();
          if (err) {
            console.log(chalk.red('ä¸‹è½½å¤±è´¥ğŸ˜­'));
          } else {
            shell.sed(
              '-i',
              'yd-vue-kernel',
              answers.dirname,
              projectPath + '/package.json'
            );
            shell.cd(projectPath)
          }
        });
      });
  },
  json2ts(url) {
    const data = {
      yideng: 'laoyuan',
      data: {
        age: 30 || '',
      },
    };
    const jsonContent = JSON.stringify(data);
    let result = json2ts.convert(jsonContent);
    console.log(result);
  },
};
```
# æ€»ç»“

æ­å»ºä¸€ä¸ªå®Œæ•´çš„ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤

- å»ºç«‹å¯¹é¥®çš„æ–‡ä»¶ç›®å½•ï¼Œåˆ›å»ºbin/cli
- åœ¨package.jsonä¸­æ·»åŠ binå‘½ä»¤ï¼Œç„¶ånpm linkå°±å¯ä»¥å…¨å±€å¼•ç”¨äº†ï¼Œå‘å¸ƒåˆ°npmä¸Šä¹Ÿå¯ä»¥é€šè¿‡å…¨å±€å®‰è£…ã€‚
- å®‰è£…commander(è·å–ç”¨æˆ·æ“ä½œçš„å‘½ä»¤)å’Œshelljs(ä¸æ“ä½œç³»ç»Ÿäº¤äº’)
- åˆ©ç”¨commanderå…ˆè®¾ç½®æ“ä½œå‘½ä»¤ï¼Œæ ¹æ®ä¸åŒçš„å‘½ä»¤æ‰§è¡Œä¸åŒæ˜¯äº‹ä»¶ï¼Œæ¯”å¦‚createï¼Œç”¨æ¥åˆ›å»ºé¡¹ç›®ï¼Œå¹¶ä¸‹è½½gitçš„æ¨¡æ¿æ–‡ä»¶
- å®‰è£…inquirer,ç”¨æ¥ä¸ç”¨æˆ·äº¤äº’ï¼Œåœ¨è¿™é‡Œæä¾›ç”¨æˆ·ç¼–å†™é¡¹ç›®åç§°ã€å¯ä¾›é€‰æ‹©çš„é¡¹ç›®æ¨¡æ¿æ–‡ä»¶ã€‚
- è·å–åˆ°ç”¨æˆ·å½“å‰æ“ä½œçš„ç›®å½•ï¼Œç„¶åæ ¹æ®ç”¨æˆ·çš„é€‰æ‹©ä¸‹è½½ä¸åŒçš„æ¨¡æ¿ï¼Œç„¶åç”¨shell.sedä¿®æ”¹ç”¨æˆ·çš„package.jsonçš„ä¿¡æ¯
- ç„¶åé€šè¿‡shelljså®‰è£…ç›¸å…³çš„ä¾èµ–ã€‚

