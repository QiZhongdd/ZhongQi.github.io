---
layout: post
title: git的分支策略
subtitle: git的分支策略
date: 2021-08-06
author: Qi
header-img: img/404-bg.jpg
catalog: true
tags:
  - 持续交付
---

# 简介

高效的持续交付策略必须要有一个合适的代码分支策略，不同的分支策略意味着实施不同的代码集成与上线策略，也影响着研发团队每日的协作方式。主要的分支策略有主干分支，git Flow 、github flow 、gitlab flow。后面三个称为特性分支。

# 主干分支

所谓的主干分支就是一直往 master 分支 push 代码，分支用来发布，这样避免了合并分支的麻烦，同时由于不采用特性分支进行开发，为了保证主干线上的有效性，会采用特性切换，特性切换相当于一个开关用来控制功能是否打开。主干分支对于技术人员的要求比较高，特性切换需要健壮的工程过程、可靠的技术设计和成熟的特性切换生命周期管理

# git flow

git flow 分支策略比较繁琐，一般不会去用，大家普遍认为 hotfix 分支和 release 分支显得多余。注意的分支角色有

master 分支：线上稳定的代码
hotfix: 当发现线上代码有 bug 时会从 master 切出个 hotfix 用来修复，然后合并到 master
release 分支：从 master 分支切出来开发新的功能版本，下次发布需要的分枝
develop：从 release 分支切出来用来开发，然后合并到 release
feature:从 develop 切出来开房特性的功能，合并到 develop

# github flow

在 github flow 中，master 分支包含稳定的代码，它已经或即将被部署到生产环境，任何人员都不能将未经测试的代码提交到 master 分支中。对代码的修改都得在一个新分支上进行。

github flow 需要注意的事项较少，简单实用，很容易养成习惯。提交代码通过审核、持续集成的自动化测试就可以添加进 master。

# gitlab flow

gitlab flow 根据不同的发布场景在 github flow 的基础上衍生了三个子类模型

- 带生产的分支：不知道新功能的发布时间，需要一个 production 分支用来存放发布的代码
- 带环境的分支：需要对不同的环境进行测试或者需要在不同的环境下开发
- 带发布的分支：需要对外部发布产品，但由需要同时维护多个版本。或者修养修改 bug 后合并到 master，最后 cherry pick 到 release 分支。

**选择合适的分支**

开源性质的项目，为什么不适合用主干开发的分支策略？

开源性质的项目比较适合 gitlab flow 带生产的分支策略，因为需要同时维护多个版本，稳定的推进和测试新代码的影响。不适合主干开发的分支策略是因为贡献者可能对项目整体的架构不清楚，并且贡献者的能力参差不齐，修改代码很容易导致其他的问题。

如果你所在的团队只有 5 人，而且迭代周期为 1 周，你会采用什么样的分支策略

在团队开发人手和时间有限的情况下，虽然追求效率，但必须保证线上版本是一个稳定，会选择 github flow 分支策略能够快速上手，简单实用。
