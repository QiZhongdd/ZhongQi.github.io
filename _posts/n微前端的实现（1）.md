---
layout: post
title:  å¾®å‰ç«¯çš„æ€è€ƒ
subtitle: å¾®å‰ç«¯çš„æ€è€ƒ
date: 2020-09-28
author: Qi
header-img: img/404-bg.jpg
catalog: true
tags:
  - å¾®å‰ç«¯
---

# ä½¿ç”¨iFrameåµŒå¥—ï¼ˆæ”¹é€ æˆæœ¬ä½ï¼Œå¯ä»¥å¿«é€Ÿä¸Šçº¿ï¼‰
- iframeçš„æ˜¾ç¤ºåŒºåŸŸä¸å—æ§åˆ¶ï¼Œå­˜åœ¨ä¸€å®šçš„å±€é™æ€§ã€‚ï¼ˆè°ƒè¯•å¾ˆéº»çƒ¦ï¼‰
- urlçš„è®°å½•å®Œå…¨æ— æ•ˆï¼Œé¡µé¢åˆ·æ–°æ— æ³•è®°å½•ã€‚åˆ·æ–°ä¼šå›åˆ°é¦–é¡µã€‚åœ¨iframeæ— æ³•å‰è¿›å’Œåé€€ã€‚æ— æ³•è§£å†³
- iframeçš„æ ·å¼å’Œå…¼å®¹æ€§è¾ƒå·®
- iframeä¼šé˜»å¡onload,å ç”¨è¿æ¥æ± ï¼Œå¤šå±‚åµŒå¥—ä¼šå´©æºƒ

# ä½¿ç”¨System.jså¼‚æ­¥åŠ è½½åŒ…

- è¿ç”¨webpackæ„å»ºä¸€ä¸ªç®€å•ç»„ä»¶ï¼Œå¹¶ä½¿ç”¨weboack-system-registeræ’ä»¶,æ”¹æ’ä»¶å°†æ†ç»‘åŒ…åŒ…è£…åœ¨System.registerè°ƒç”¨ä¸­ã€‚è¿™ä½¿å¾—webpackæŸå®Œå…¨å¯ä»¥ç”±SystemJSæ¶ˆè€—ã€‚

- SystemJSåŠ¨æ€åŠ è½½çš„æ¨¡å—å¿…é¡»æ˜¯SystemJSæ¨¡å—æˆ–è€…UMDæ¨¡å—ï¼›

```
// webpack-config.js
 plugins: [
    new WebpackSystemRegister({
      // systemjsDeps: [/^react/, 'react-dom'],
      // registerName: '',
    }),
  ],

```
- buyListç»„ä»¶ï¼ŒbuyListç»„ä»¶é‡‡ç”¨eventBusè¿›è¡Œé€šä¿¡

```

<template>
  <div class="buylist">
    <h1>æˆ‘æ˜¯è´­ä¹°ç»„ä»¶ï¼</h1>
    <input type="button" value="ç‚¹å‡»æµ‹è¯•" @click="initFn" />
  </div>
</template>

//ä½¿ç”¨cssmoduleåšåˆ°æ ·å¼éš”ç¦»
<style scoped>
.buylist h1 {
  color: yellowgreen;
}
</style>

<script>

export default {
  name: "BuyList",
  methods: {
    initFn() {
      //åˆ¤æ–­å…¨å±€ç¯å¢ƒä¸­æœ‰æ²¡æœ‰eventBusï¼Œç„¶åé€šä¿¡
      if(window.listener){
        listener.trigger('com.myTest', 'say', 'Hello World!');
      }
      console.log("ğŸ»", Math.random())
    },
  }
};

</script>


```

- vueä¸»é¢˜ä½¿ç”¨system.jså¼•å…¥å¼‚æ­¥ç»„ä»¶

```

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>H5ä¸»ç«™</title>
    <script src="https://cdn.staticfile.org/vue/2.6.9/vue.min.js"></script>
    <script src="https://cdn.staticfile.org/vue-router/3.4.3/vue-router.min.js"></script>
    <script src="https://cdn.staticfile.org/systemjs/6.5.1/system.min.js"></script>
    <script src="./listener.js"></script>
  </head>
  <body>
    <div id="app"></div>

    <!--
      â‘  åŒæ­¥çš„ç»„ä»¶
      â‘¡ è·¯ç”±å†™æ­»äº† æ¯æ¬¡  router.jsonæ–‡ä»¶ /buylist -ã€‹ buylist.xxx66.js
      â‘¢ webpackæ¶å¿ƒ é‚£å †æ¨¡å—åŒ–çš„æœºåˆ¶å§‹ç»ˆæ²¡æœ‰å»æ‰
      â‘£ reactå¼•å…¥è¿›æ¥ å¯¹react+vueçš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œç»Ÿä¸€çš„å¤„ç†
    -->
    
    <script>
      Vue.use(VueRouter);
      const router = new VueRouter({
        mode: 'history',
        routes: [
          {
            path: '/buylist',
            name: 'buylist',
            component: () =>
              System.import('http://localhost/buylist.js'),
          },
        ],
      });
      Vue.component('app', {
        template: `<div class="app">
        <h2>å¾®å‰ç«¯çš„éƒ¨ç½²æ–¹æ¡ˆ</h2>
        <hr />
        <router-link to="/buylist">è´­ä¹°ç»„ä»¶</router-link>
        <router-view></router-view>
      </div>`,
      mounted() {
          //æ¥å—å­ç»„ä»¶çš„é€šä¿¡
        listener.on('com.myTest', 'say', function(d){alert(d);});
      },
      });
      new Vue({
        router,
        template: '<app/>',
      }).$mount('#app');
    </script>
  </body>
</html>

```


**Module Federation**

è®© Webpack è¾¾åˆ°äº†çº¿ä¸Š runtime çš„æ•ˆæœï¼Œè®©ä»£ç ç›´æ¥åœ¨ç‹¬ç«‹åº”ç”¨é—´åˆ©ç”¨ CDN ç›´æ¥å…±äº«ï¼Œä¸å†éœ€è¦æœ¬åœ°å®‰è£… NPM åŒ…ã€æ„å»ºå†å‘å¸ƒäº†ï¼
æœ‰äº†è¯¥ç‰¹æ€§å°±å¯ä»¥å¤šä¸ªå•ç‹¬çš„æ„å»ºåº”èƒ½å¤Ÿæ„æˆä¸€ä¸ªåº”ç”¨ã€‚ è¿™äº›ç‹¬ç«‹çš„æ„å»ºä¸ç›¸äº’ä¾èµ–ï¼Œå› æ­¤å¯ä»¥å•ç‹¬å¼€å‘å’Œéƒ¨ç½²ã€‚ è¿™æ ·ä¹Ÿèƒ½å®ç°å¾®å‰ç«¯ã€‚
ä»å›¾ä¸­å¯ä»¥å¾—çŸ¥å°±æ˜¯å°†ä¸€ä¸ªåº”ç”¨çš„bundleèƒ½å¤Ÿè¢«å¦ä¸€ä¸ªåº”ç”¨å¼•ç”¨ã€‚åº”ç”¨å¯ä»¥æ¨¡å—åŒ–è¾“å‡ºï¼Œå°±æ˜¯è¯´å®ƒæœ¬èº«å¯ä»¥è‡ªæˆ‘æ¶ˆè´¹ï¼Œä¹Ÿå¯ä»¥åŠ¨æ€åˆ†å‘ runtime å­æ¨¡å—ç»™å…¶ä»–åº”ç”¨ã€‚

![Image text](/img/WechatIMG421.png)

app1å’Œapp2çš„å…¥å£æ–‡ä»¶
```
// app1 & app2: index.js
import App from "./App";
import React from "react";
import ReactDOM from "react-dom";

ReactDOM.render(<App />, document.getElementById("root"));

```

app2 ç”Ÿäº§äº† Button ç»„ä»¶ï¼š

```
// app2: Button.js
import React from "react";

const Button = () => <button>App 2 Button</button>;

export default Button;

```

app2.js

```
// app2: App.js
import LocalButton from "./Button";
import React from "react";

const App = () => (
  <div>
    <h1>Basic Host-Remote</h1>
    <h2>App 2</h2>
    <LocalButton />
  </div>
);

export default App;

```

app1 å¼•ç”¨ app2 çš„ Button ç»„ä»¶ï¼š

```
// app1: App.js
import React from "react";
const RemoteButton = React.lazy(() => import("app2/Button"));

const App = () => (
  <div>
    <h1>Basic Host-Remote</h1>
    <h2>App 1</h2>
    <React.Suspense fallback="Loading Button">
      <RemoteButton />
    </React.Suspense>
  </div>
);

export default App;

```

ç”Ÿäº§äº† Button ç»„ä»¶çš„ app2ï¼Œå…¶é…ç½®æ–‡ä»¶ï¼š

```
plugins: [
    new ModuleFederationPlugin({
      name: "app2Lib",//åº”ç”¨åç§°
      library: { type: "var", name: "app2Lib" },
      filename: "app2-remote-entry.js",//ç”Ÿæˆçš„å…¥å£æ–‡ä»¶
      exposes: {
        Button: "./src/Button",//éœ€è¦å¯¼å‡ºçš„æ–‡ä»¶
      },
      shared: ["react", "react-dom"],//éœ€è¦ä¾èµ–çš„åº“
    })
  ],
```

app1 çš„é…ç½®æ–‡ä»¶ï¼š

```
  new ModuleFederationPlugin({
      name: "app1",
      library: { type: "var", name: "app1" },
      remotes: {
        app2: "app2Lib",//éœ€è¦ç”¨åˆ°çš„è¿œç¨‹æ–‡ä»¶
      },
      shared: ["react", "react-dom"],
    }),
```

åœ¨ app1 html ä¸­åŠ è½½ app2-remote-entry.jsï¼š

```
<html>
  <head>
    <script src="http://localhost:3002/app2-remote-entry.js"></script>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>

```

**å»ºç«‹ç§æœï¼Œå¼•å…¥ç§åº“**

å»ºç«‹ç§æœï¼Œå°†ç»„ä»¶æˆ–è€…åº”ç”¨ä¸¢åˆ°ç§æœä¸Šï¼Œéœ€è¦çš„æ—¶å€™installå¹¶importå°±å¯ä»¥äº†




